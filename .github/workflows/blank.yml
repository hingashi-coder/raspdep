# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the main branch
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: run deploy script
      env:
        SECRET_KEY: ${{ secrets.SECRET }}
        EC2_USER: ${{ secrets.USERNAME }}
        EC2_HOST: ${{ secrets.IP }}
        SLACK_URL: ${{ secrets.SLACK_URL }}
      run: | 
        # 秘密鍵にファイル名secret_keyをつける
        echo "$SECRET_KEY" > secret_key
        # パーミッションの変更    
        chmod 600 secret_key
        # ssh接続　＞　デプロイするディレクトリに行く　＞　デプロイ
        ssh -oStrictHostKeyChecking=no ${EC2_USER}@${EC2_HOST} -t -i secret_key "cd ~/ && git pull origin master && "SLACK_URL=$(printf %q "${SLACK_URL") bash" "
        
        
        
        
